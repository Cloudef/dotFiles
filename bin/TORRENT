#!/bin/sh

PIDFILE="/tmp/TORRENT.pid"
SOCKET="/tmp/TORRENT.sck"
if [ -e "$PIDFILE" ]; then
   PID="$(cat "$PIDFILE")"
   if kill -0 $PID; then
      echo "Already running"
      exit 1
   else
      rm "$PIDFILE"
   fi
fi

if [ -e "$SOCKET" ]; then
   urxvt -title rTorrent -name rTorrent -e dtach -a "$SOCKET" &
   echo "$!" > "$PIDFILE"
   sleep 3 && transset-df --no-regex -n rTorrent --dec 0.1
   exit 1
fi

if [ ! -e "$PIDFILE" ]; then
   urxvt -title rTorrent -name rTorrent -e dtach -c "$SOCKET" rtorrent &
   echo "$!" > "$PIDFILE"
   sleep 3 && transset-df --no-regex -n rTorrent --dec 0.1
fi
